# 議事録：技術チームミーティング
**日時**: 2025年10月23日（木）14:01～14:29

---

## **外部アクセス時の監査情報（メールアドレス文字数制限）対応**

### **討議内容**

- 外部アクセス時、データベースレコードの監査フィールド（`created_by`, `updated_by`）にメールアドレス（文字列）が格納される。
- 現在の文字数上限は50文字だが、自動生成メールアドレス等で50文字を超えるケースが発生している。
- 当初、EC締結関連の8～9テーブルのみ文字数上限を50文字→150文字に変更する短期対応と、全テーブルの監査フィールドを150文字に拡張する長期対応が提案された。
- しかし、RFCの規定ではメールアドレスの最大長は254文字であり、150文字ではなく254文字に合わせるべきとの指摘があった。
- また、外部アクセスは将来的に「ゲストID」で管理する方向が望ましいとの提案もあった。ゲストID管理にすれば監査フィールドの文字数拡張が不要になる。
- 監査項目をアプリケーション上で直接表示することを避け、メールアドレス等の連絡先情報は別テーブルで管理する方向性が議論された。

### **結論・ネクストアクション**

- 短期対応として、EC締結関連の8テーブルについて、文字数上限を50文字→254文字に変更する（RFC基準に準拠）。
- 長期対応として、外部アクセスをゲストIDベースで管理する設計に移行を検討する。
- 設計を再検討し、チームに持ち帰る。

---

## **設計レビュー効率化の進捗**

### **討議内容**

- FI側のタスクが現在サイクルに含まれておらず、CLMのライフサイクル対応時に課題として浮上する見込み。
- タイミングは次スプリントまたはその次のスプリントを想定。
- API側では実施しているが、特にコメント等は発生しておらず、効果はまだ不明。

### **結論・ネクストアクション**

- ステータスは進行中（DOING）として継続。
- 引き続き経過観察を行い、CLMライフサイクル対応時に実施予定。

---

## **テンプレート複製機能の調査状況**

### **討議内容**

- 調査中だが優先度が下がっており、まだ進捗がない。
- タスクとして認識されており、今後対応予定。

### **結論・ネクストアクション**

- ステータスは継続（様子見）とし、調査を継続する。

---

## **ファイル名文字数カウント方法の統一**

### **討議内容**

- フィードバックを受け、プロダクト全体での文字数カウント方針を統一したいとの課題が提起された。
- 現状、拡張子を含む/含まないがバラバラで、基本は拡張子を含まない100～150文字だが、APIv2移行部分は全体で150文字バリデーションとなっている。
- 提案として、拡張子を含めて200文字以内で統一し、既存データで上限超過を防ぐため余裕を持って200文字に設定することが示された。
- ファイルアップロード時の契約書名の扱いが懸念点として挙げられ、UI側でファイル名から自動入力される契約書名の桁数制限や、締結アップロード時にファイル名がそのまま契約書名になる点が議論された。
- 議論の結果、ファイル名のバリデーションを最大値とし、それに合わせる方針で合意。拡張子を含めることに対しては問題ないとの結論に至った。

### **結論・ネクストアクション**

- 文字数カウント方針を拡張子を含めて200文字以内で統一する。
- 今後の実装で統一し、既存部分も順次修正していく。

---

## **URL締結での認証・署名者不一致問題**

### **討議内容**

- URL締結でメールアドレス認証後、画面を開きっぱなしの状態で別の人が認証すると、後勝ちで署名者情報が上書きされる問題が報告された。
- 具体例：ユーザーAが認証してアクセス→画面開きっぱなし→ユーザーBが認証→ユーザーAが締結実行→署名者がユーザーBになってしまう。
- この問題は仕様として説明するのは難しく、技術的に修正すべきとの見解が示された。
- 最後に認証した人と締結した人が異なる場合、エラーを出す対応を実施する方針が検討された。

### **結論・ネクストアクション**

- 認証者と締結者の不一致を検知してエラーとする対応方針を採用。
- 修正実装を実施する。

---

## **全体サマリー：アクションアイテム一覧**

| No. | テーマ | アクション内容 | 期限 |
|-----|--------|---------------|------|
| 1 | 外部アクセス監査情報 | 設計見直し（254文字対応、ゲストID管理方式検討） | TBD |
| 2 | 設計レビュー効率化 | 継続実施（CLMライフサイクル対応時） | 次スプリント以降 |
| 3 | テンプレート複製機能 | 調査継続 | TBD |
| 4 | ファイル名文字数 | バリデーションの統一実装（拡張子含む200文字） | TBD |
| 5 | URL締結認証不一致 | 認証・署名者不一致問題の修正 | TBD |

